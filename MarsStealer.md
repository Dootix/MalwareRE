## Hashes ## 

SHA256 - fdf6b1ad42f7b3c555a9cfef369fa1467facd71efd10d0e287ce2f32f77e5551

## Sandbox ##

![image](https://github.com/Dootix/MalwareRE/assets/24233481/e798f5bd-0ae5-4103-bf95-f535ad575b1b)

![image](https://github.com/Dootix/MalwareRE/assets/24233481/98ec8168-0765-41be-99a5-ec3c45cb23ba)

## Extracted IOCs
- http://aidandylan{.}top/3886d2276f6914c4
- http://aidandylan{.}top/f059ec3d7eb90876/sqlite3.dll  
- 85.143.221.30 
- sqlite3.dll

## File signature ## 
MarsStealer.exe.malz: PE32 executable (GUI) Intel 80386
C/C++ - compiled

![image](https://github.com/Dootix/MalwareRE/assets/24233481/7cb2e0c9-ed89-417a-a4ee-28891de0a25f)

- compiler stamp -> Sun Dec 11 05:00:59 2022 | UTC
- version -> **Bujingle.exe / NubiliousForm.exe**
- Doesn't appear to be packed.

![image](https://github.com/Dootix/MalwareRE/assets/24233481/ad54c3bb-d700-42c0-8823-4fc2ec8d5fd2)

## Interesting imports ##

- DeleteVolumeMountPointW,x,0x0003583C,0x0003583C,220 (0x00DC),storage,T1006 | File System Logical,implicit,-,KERNEL32.dll
- VirtualProtect,x,0x00035B12,0x00035B12,1263 (0x04EF),memory,T1055 | Process Injection,implicit,-,KERNEL32.dll
- WriteFile,x,0x00035764,0x00035764,1317 (0x0525),file,-,implicit,-,KERNEL32.dll
- CreateHardLinkA,x,0x000356BA,0x000356BA,144 (0x0090),file,-,implicit,-,KERNEL32.dll
- IsDebuggerPresent,-,0x00035E16,0x00035E16,768 (0x0300),reconnaissance,T1082 | System Information Discovery,implicit,-,KERNEL32.dll
- WinHttpReadData,x,0x00035C5E,0x00035C5E,21 (0x0015),network,-,implicit,-,WINHTTP.dll
- WriteFile,x,0x00035764,0x00035764,1317 (0x0525),file,-,implicit,-,KERNEL32.dll
- CreateMailslotW,-,0x00035936,0x00035936,153 (0x0099),data-exchange,-,implicit,-,KERNEL32.dll

- Suspicious name of the resource in .rsrc section of the PE file:
![image](https://github.com/Dootix/MalwareRE/assets/24233481/6e4fc454-3a67-437c-89b1-01ca2fb5f238)

- Resource is full of obfuscated/encrypted code.

![image](https://github.com/Dootix/MalwareRE/assets/24233481/8e68b700-4d31-4066-b020-7414104dfdb1)

## Strings ##

- IOCs appear to be hard-coded into the sample, we can see the malicious C2 and original filenames.
![image](https://github.com/Dootix/MalwareRE/assets/24233481/cc270236-7f43-4fed-9c43-b69547e19abf)

## IDA ## 

- Heap creation - 1000h in size.
![image](https://github.com/Dootix/MalwareRE/assets/24233481/3194b1af-7099-4ff2-93ca-35441d66e179)

- Many examples of junk code below - there are no logical arguments being passed, everything is zeored out when invoking the functions.
- Most of them will return null/false. Code exists for obfuscation purposes.

![image](https://github.com/Dootix/MalwareRE/assets/24233481/7c95a9e4-3211-48b1-9889-4a57c0bc6bd5)

## x32dbg ##

- Interesting insight here - malware is creating strings dynamically using stack.
![image](https://github.com/Dootix/MalwareRE/assets/24233481/982e1923-6648-4146-afcf-091a648d9bfb)

- Another example - dynamically creating string which is a registry entry for internet settings.
  ![image](https://github.com/Dootix/MalwareRE/assets/24233481/7e988d0a-5c5f-47aa-be9f-5a9fa85ffe39)

- suspicious values "MBCSAPIForCrack" and "TQIp" are being passed as arguments to RtlInitUnicodeStringEx, suggesting that there are some decoding operations being applied.
  ![image](https://github.com/Dootix/MalwareRE/assets/24233481/e080e238-15d7-47c8-a2e4-d46b7f6be20a)

- Malware opens and writes to IE's feature control registry key:
![image](https://github.com/Dootix/MalwareRE/assets/24233481/33e0b8ad-1ccb-4073-9969-3972920c6786)

- Here, we can see that C2 domain details are being created on the stack and passed to memory.

  ![image](https://github.com/Dootix/MalwareRE/assets/24233481/3f823bf6-0094-4c9b-850e-5cc1f257ccac)

  WIP.














